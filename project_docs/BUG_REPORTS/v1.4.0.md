# Bug Report & Fix Plan: v1.4.1

**Version:** v1.4.1
**Status:** COMPLETE ‚úÖ
**Last Updated:** November 7, 2025

---

## Overview

This document tracks the bug fixes targeted for the v1.4.1 patch release. The goal is to address critical and high-priority usability issues identified after the v1.4.0 release before beginning v1.5.0 feature work.

**Current Progress:** 4 of 4 targeted bugs have been resolved. ‚úÖ

---

## ‚úÖ Resolved Issues

### **Issue #1: InfoModal Import Error (Critical üî¥)**

- **Status:** `[RESOLVED]` (Session 39)
- **Symptom:** Clicking the `</>` icon in the navbar crashed the application with a React error: "Element type is invalid".
- **Root Cause:** Mismatched default vs. named imports in `InfoModal.tsx`.
- **Resolution:** Corrected the import statements to use default import syntax.

### **Issue #2: Recent Races Date Overflow (High üü°)**

- **Status:** `[RESOLVED]` (Session 39)
- **Symptom:** On the dashboard, the date in the "Recent Races" list would wrap or overflow its container.
- **Root Cause:** Incorrect flexbox container properties.
- **Resolution:** Applied appropriate Tailwind CSS flexbox utilities (`min-w-0`, `flex-shrink-0`) to ensure proper truncation.

### **Issue #3: Dashboard Keyboard Shortcuts Broken (High üü°)**

- **Status:** `[RESOLVED]` (Session 40)
- **Symptom:** Game-specific keyboard shortcuts (Alt+Arrows, Tab) were active globally, causing runtime errors on pages like `/dashboard`.
- **Root Cause:** The global keyboard handler in `_app.tsx` was initialized before the `game` object existed in the Zustand store, creating a stale reference.
- **Resolution:**
  1. Removed game-specific shortcut logic from the global handler in `_app.tsx`.
  2. Relocated the event listener logic into the `useGame.ts` hook, ensuring it is only active when a `game` instance exists.
  3. Implemented `nextLanguage` and `previousLanguage` functions in `settings-store.ts` to handle language cycling, as this logic was missing.

### **Issue #6: Language Selector UI Desynchronization (High üü°)**

- **Status:** `[RESOLVED]` (Session 42) ‚úÖ
- **Symptom:** When changing the programming language via the `Alt+Arrow` keyboard shortcuts:
  - Code snippet correctly updated to the new language
  - Language button in the footer did not update (showed wrong language)
  - Toast notification showed stale/incorrect language names
- **Root Cause:** 
  - **Duplicate keyboard event handlers** in `index.tsx` and `useGame.ts` responding to the same shortcuts
  - Handlers reading from **different data sources** (SWR cache vs Zustand store)
  - Created a race condition where toast showed stale data from SWR while UI used fresh Zustand data
- **Resolution:**
  1. Removed duplicate keyboard handlers from `index.tsx`
  2. Added toast notifications directly to `nextLanguage()` and `previousLanguage()` in `settings-store.ts`
  3. Replaced Headless UI `Listbox` with standard HTML `<select>` element for simplicity
  4. Established single source of truth: all language state managed through `settings-store.ts`
- **Files Modified:**
  - `packages/webapp-next/modules/play2/state/settings-store.ts`
  - `packages/webapp-next/modules/play2/components/race-settings/LanguageSelector.tsx`
  - `packages/webapp-next/pages/index.tsx`

---

## üìã Cleanup Tasks (Before v1.4.1 Release)

### **Task #1: Remove Debug Logging**
- **Status:** `[PENDING]`
- **Files:** `LanguageSelector.tsx`, `useGame.ts`
- **Action:** Remove temporary console.log statements added during debugging

### **Task #2: Fix Zustand Deprecation Warnings**
- **Status:** `[PENDING]`
- **Files:** `code-store.ts`, `user-store.ts`, `settings-store.ts`, `game-store.ts`, `connection-store.ts`
- **Action:** Change `import create from 'zustand'` to `import { create } from 'zustand'`

### **Task #3: Fix React forwardRef Warning**
- **Status:** `[PENDING]`
- **File:** `common/components/Button.tsx`
- **Action:** Use `React.forwardRef()` or remove ref passing

---

## ‚è∏Ô∏è Deferred to Future Releases

### **Issue #4: Large Screen Layout (Medium üü¢)**

- **Status:** `[DEFERRED]`
- **Target Version:** `v1.4.2`
- **Description:** Margins are too small on large (24"+) monitors, and the main coding area is not centered, leading to poor ergonomics.

### **Issue #5: Stats Feature Requests (Medium üü¢)**

- **Status:** `[DEFERRED]`
- **Target Version:** `v1.5.0+`
- **Description:** User requests to enhance the dashboard statistics, such as limiting recent races to 5 and adding new metrics like "most mistyped characters".

---

## Release Checklist

- [x] Issue #1: InfoModal Import Error - RESOLVED
- [x] Issue #2: Recent Races Date Overflow - RESOLVED
- [x] Issue #3: Dashboard Keyboard Shortcuts Broken - RESOLVED
- [x] Issue #6: Language Selector UI Desynchronization - RESOLVED
- [ ] Remove debug logging
- [ ] Fix Zustand deprecation warnings
- [ ] Fix React forwardRef warning
- [ ] Complete smoke test
- [ ] Create git tag v1.4.1
- [ ] Update CHANGELOG.md
```

---

**Session 42 Complete!** üéâ

Issue #6 is finally resolved after 4 sessions. The bug turned out to be more complex than expected (duplicate event handlers + multiple data sources), but the methodical approach in this session paid off. 

Next session will focus on cleanup and preparing for the v1.4.1 release!